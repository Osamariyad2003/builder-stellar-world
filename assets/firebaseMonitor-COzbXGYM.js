let l=!1,d=[],a=0;const b=3,c=e=>{l!==e&&(l=e,console.log(`ðŸ”„ Firebase mode changed: ${e?"OFFLINE":"ONLINE"}`),d.forEach(o=>o()))},h=()=>l,p=e=>(d.push(e),()=>{d=d.filter(o=>o!==e)}),u=e=>{a++,console.log(`ðŸš¨ Firebase error ${a}/${b}:`,e.message),a>=b&&(console.log("ðŸ”„ Too many Firebase errors - switching to global offline mode"),c(!0))};if(!window.fetch.__firebasePatched){const e=window.fetch,o=(...i)=>{var g;const r=typeof i[0]=="string"?i[0]:(g=i[0])==null?void 0:g.url;if(!(!!r&&(r.includes("firestore.googleapis.com")||r.includes("firebase.googleapis.com")||r.includes("identitytoolkit.googleapis.com"))))try{return e(...i)}catch(n){return Promise.reject(n)}if(l){const n=new Error("Firebase offline mode - request blocked");return n.isFirebaseOfflineError=!0,Promise.reject(n)}try{const n=e(...i);return Promise.resolve(n).then(s=>(s.ok&&(a=0,l&&(console.log("ðŸŸ¢ Firebase connection restored"),c(!1))),s)).catch(s=>{console.log("ðŸ”´ Firebase request failed:",(s==null?void 0:s.message)||String(s));const f=String(s&&(s.stack||"")||""),m=String((s==null?void 0:s.message)||s||"").toLowerCase();throw!(f.includes("chrome-extension://")||f.includes("extension://")||m.includes("extension"))&&navigator.onLine&&u(s),s})}catch(n){console.log("ðŸ”´ Firebase request threw synchronously:",(n==null?void 0:n.message)||String(n));const s=String(n&&(n.stack||"")||""),f=String((n==null?void 0:n.message)||n||"").toLowerCase();return!(s.includes("chrome-extension://")||s.includes("extension://")||f.includes("extension"))&&navigator.onLine&&u(n),Promise.reject(n)}};o.__firebasePatched=!0,window.fetch=o}console.log("ðŸ”„ Initializing Firebase monitoring...");navigator.onLine||(console.log("ðŸš« No internet connection - starting in offline mode"),c(!0));window.addEventListener("online",()=>{console.log("ðŸŸ¢ Internet connection restored"),a=0,c(!1)});window.addEventListener("offline",()=>{console.log("ðŸ”´ Internet connection lost"),c(!0)});console.log("ðŸ”„ Starting Firebase monitoring in ONLINE mode");window.addEventListener("unhandledrejection",e=>{var r;const o=String(((r=e==null?void 0:e.reason)==null?void 0:r.message)||(e==null?void 0:e.reason)||""),i=String((e==null?void 0:e.reason)&&(e.reason.stack||"")||"");if((o.includes("Failed to fetch")||o.toLowerCase().includes("extension"))&&(i.includes("chrome-extension://")||i.includes("extension://")||i.includes("fullstory.com"))){e.preventDefault();return}if(i.includes("chrome-extension://")||i.includes("extension://")){e.preventDefault();return}});const F=console.error,w=console.warn,E=console.log;console.error=(...e)=>{const o=e.map(t=>t&&typeof t=="object"?String(t):t).join(" "),i=e.some(t=>t&&typeof t=="object"&&t.stack&&t.stack.includes("chrome-extension://"));["Firebase offline mode - request blocked","FirebaseError: [code=unavailable]","Could not reach Cloud Firestore backend","Connection failed","The operation could not be completed","device does not have a healthy Internet connection","client will operate in offline mode","Most recent error: FirebaseError","@firebase/firestore: Firestore","fullstory.com","TypeError: Failed to fetch"].some(t=>o.includes(t))||i||o.includes("chrome-extension://")||o.includes("extension://")||F.apply(console,e)};console.warn=(...e)=>{const o=e.join(" ");o.includes("Firebase")&&o.includes("offline")||w.apply(console,e)};console.log=(...e)=>{const o=e.join(" ");o.includes("@firebase/firestore")&&o.includes("offline")||E.apply(console,e)};setTimeout(()=>{navigator.onLine?console.log("ðŸŒ Internet available - Firebase enabled and ready"):(console.log("ðŸš« No internet connection detected - switching to offline mode"),c(!0))},100);const x=()=>{if(l){const e=()=>(console.log("ðŸš« Firebase function called in offline mode - skipping"),Promise.reject(new Error("Firebase is offline")));if(typeof window<"u"){const o=window.firebase;o&&(o.initializeApp=e,o.app=e)}}},L={setFirebaseOffline:c,isFirebaseInOfflineMode:h,addOfflineModeListener:p,reportFirebaseError:u,disableFirebaseWhenOffline:x};export{p as addOfflineModeListener,L as default,x as disableFirebaseWhenOffline,h as isFirebaseInOfflineMode,u as reportFirebaseError,c as setFirebaseOffline};
